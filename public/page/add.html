
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles/display.css">
  <title>Thêm Sản Phẩm</title>
</head>
<style>
  body {
    font-family: Arial;
    padding: 20px;
    max-width: 800px;
    margin: auto;
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }

  input,
  textarea,
  select {
    width: 100%;
    padding: 6px;
    margin-top: 5px;
  }

  fieldset {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }

  legend {
    font-weight: bold;
  }

  .row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }

  .row>* {
    flex: 1;
  }

  button {
    padding: 10px 20px;
    margin-top: 20px;
  }
</style>

<body>
  <header>
    <div class="logo"><a href="/">LOGO</a></div>
</header>
  <div class="container">
    <aside class="sidebar">
        <h2>Quản lý sản phẩm</h2>
        <ul>
            <li><a href="/add.html">Thêm sản phẩm</a></li>
            <li><a href="/display.html">Danh sách sản phẩm</a></li>
        </ul>
    </aside>
    <main class="content">
        <h2>Thêm sản phẩm</h2>
        <form id="productForm" enctype="multipart/form-data" method="POST">
          <h1>Nhập Thông Tin Sản Phẩm</h1>
          <label for="masp">Mã sản phẩm</label>
          <input type="text" id="maSanPham" name="maSanPham" min="0" max="9999" placeholder="Mã tạo tự động"
              style="width: 200px; padding: 6px; border: 1px solid #ccc; border-left: none; border-radius: 0 4px 4px 0;" readonly/>
          <br>
      
          <label for="loaisanpham">Loại sản phẩm</label>
          <select id="loaiSanPham" name="loaisanpham" onchange="taoMaSanPham()">
            <option value="">Chọn loại sản phẩm</option>
            <option value="AOBD">Áo bóng đá</option>
            <option value="DCTT">Dụng cụ thể thao</option>
            <option value="GIAY">Giày</option>
            </select>
          <br>
      
          <label for="tensanpham">Tên sản phẩm</label>
          <input type="text" id="tensanpham" name="tensanpham">
          <br>
      
      
          <label for="thuonghieu">Thương hiệu</label>
          <input type="text" id="thuonghieu" name="thuonghieu">
          <br>
      
          <label for="giasanpham">Giá sản phẩm (VNĐ)</label>
          <input type="number" id="giasanpham" name="giasanpham">
          <br>
      
          <label for="khuyenmai">Khuyến mãi</label>
          <input type="text" id="khuyenmai" name="khuyenmai">
          <br>
      
          <label for="mota">Mô tả</label>
          <textarea id="mota" name="mota" rows="3" style="resize: none;"></textarea>
      
          <label for="hinhanh">Tên file hình ảnh (VD: giay1.jpg)</label>
          <input type="text" id="hinhanh" name="hinhanh" placeholder="Nhập tên file ảnh (VD: giay1.jpg)">
      
          <fieldset>
            <legend>Bảng Size & Màu Sắc</legend>
            <div id="size-section">
              <div class="size-block">
                <label>Size</label>
                <input type="text" name="size[]" placeholder="VD: M, L, XL...">
                <label>Màu sắc</label>
                <input type="text" name="mausac[]" placeholder="VD: Đỏ, Xanh, Đen...">
                <label>Số lượng</label>
                <input type="number" name="soluong[]" min="0" placeholder="VD: 10">
              </div>
            </div>
            <button type="button" onclick="addSize()">+ Thêm Size</button>
            <button type="button" onclick="removeSize(this)">Xóa</button>
          </fieldset>
      
          <button type="submit">Gửi</button>
        </form>
    </main>
</div>

<script>
  async function taoMaSanPham() {
    const loai = document.getElementById("loaiSanPham").value;

    if (!loai) {
      document.getElementById("maSanPham").value = "";
      return;
    }

    const res = await fetch("/api/tao-ma", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ loaiSanPham: loai }),
    });

    const data = await res.json();
    document.getElementById("maSanPham").value = data.maSanPham;
  }
</script>

  <script>
    let sizeCount = 1;

    function addSize() {
      
      const container = document.getElementById("size-section");
      const sizeBlocks = document.querySelectorAll(".size-block");
      const currentIndex = sizeBlocks.length + 1;

      const newSizeBlock = document.createElement("div");
      newSizeBlock.className = "size-block";
      newSizeBlock.innerHTML = `
        <div class="size-header">➤ Size #${currentIndex}</div>
        <label>Size</label>
        <input type="text" name="size[]" placeholder="VD: M, L, XL...">
        <label>Màu sắc</label>
        <input type="text" name="mausac[]" placeholder="VD: Đỏ, Xanh, Đen...">
        <label>Số lượng</label>
        <input type="number" name="soluong[]" min="0" placeholder="VD: 10">

      `;

      container.appendChild(newSizeBlock);
    }

    function removeSize(button) {
      const sizeSection = document.getElementById("size-section");
      const sizeBlocks = sizeSection.querySelectorAll(".size-block");

      if (sizeBlocks.length <= 1) {
        alert("Không thể xóa khi chưa tạo bảng");
        return;
      }
      sizeSection.removeChild(sizeBlocks[sizeBlocks.length - 1]);
}

  </script>

  <script>
    document.getElementById("productForm").addEventListener("submit", function (event) {
      event.preventDefault();

      const sizeBlocks = document.querySelectorAll(".size-block");
      const bangsize = [];

      sizeBlocks.forEach(block => {
        const size = block.querySelector("input[name='size[]']").value.trim();
        const mausac = block.querySelector("input[name='mausac[]']").value.trim();
        const soluong = block.querySelector("input[name='soluong[]']").value.trim();


        if (size && mausac && soluong) {
          bangsize.push({ size, mausac, soluong });
        }
      });

      const data = {
        id: document.getElementById("maSanPham").value,
        tensanpham: document.getElementById("tensanpham").value,
        loaisanpham: document.getElementById("loaiSanPham").value,
        thuonghieu: document.getElementById("thuonghieu").value,
        giasanpham: document.getElementById("giasanpham").value,
        khuyenmai: document.getElementById("khuyenmai").value,
        mota: document.getElementById("mota").value,
        hinhanh: document.getElementById("hinhanh").value,
        bangsize: bangsize,
      };

      fetch("/themsanpham", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {alert(data.message);
          if (data.success) {
            location.reload();
          }
        })
        .catch(error => {
          console.error(error);
          alert("Đã xảy ra lỗi, vui lòng thử lại sau");
        });
        
    });
  </script>

</body>

</html>